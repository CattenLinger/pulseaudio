import test from 'ava'
import { authenticate, setClientName, getSinksReply } from '../src/command'
import PAPacket from '../src/packet'


const COOKIE = '780000010059cf1c70a28fa55cc512a36d204963e8ce8b1ccfec5ef095d9b86f1f46f88aea9cb7ea18aa7d163174353379a277ea83867f5e36560749b235f025b48da7dadc7033921b820af1c4434f3dfc196a89f8bdd7357e40dcd741ddeccbc9c5c70cf966e863fef08746912ef2550b0068f4f343f5f97a0bcedae38d66b6483f13dd6af6051ad7b44cae1322e2f1cb2ea4d4ce280cd1775327b36fadf5c5a191758a1dcb02627ddb87e376ef02603c61639b323547359dace2d7a1b1471a0599baa37a2184c0f1a849a4fbccb943a80fb7dbe4619c9e1437bc0fac2811aed25a6305ebc2a23afbc04a4e206445cb20ce8cb2d6045fc158f11533ab0c20a0cfc6c93074'

// Commands
test(`authenticate() command`, t => {
  const COMMAND_RESULT = '00000114ffffffff0000000000000000000000004c000000084c000000004c00000021780000010059cf1c70a28fa55cc512a36d204963e8ce8b1ccfec5ef095d9b86f1f46f88aea9cb7ea18aa7d163174353379a277ea83867f5e36560749b235f025b48da7dadc7033921b820af1c4434f3dfc196a89f8bdd7357e40dcd741ddeccbc9c5c70cf966e863fef08746912ef2550b0068f4f343f5f97a0bcedae38d66b6483f13dd6af6051ad7b44cae1322e2f1cb2ea4d4ce280cd1775327b36fadf5c5a191758a1dcb02627ddb87e376ef02603c61639b323547359dace2d7a1b1471a0599baa37a2184c0f1a849a4fbccb943a80fb7dbe4619c9e1437bc0fac2811aed25a6305ebc2a23afbc04a4e206445cb20ce8cb2d6045fc158f11533ab0c20a0cfc6c93074'
  const query: PAPacket = authenticate(0, Buffer.from(COOKIE, 'hex'))
  t.is(query.write().toString('hex'), COMMAND_RESULT)
})

test(`setClientName() command: default name`, t => {
  const COMMAND_RESULT = '00000035ffffffff0000000000000000000000004c000000094c0000000050746170706c69636174696f6e2e6e616d65004c0000000d780000000d70616c69622d636c69656e74004e'
  const query: PAPacket = setClientName(0)
  t.is(query.write().toString('hex'), COMMAND_RESULT)
})

test(`setClientName() command: custom name`, t => {
  const COMMAND_RESULT = '00000034ffffffff0000000000000000000000004c000000094c0000000050746170706c69636174696f6e2e6e616d65004c0000000c780000000c637573746f6d2d6e616d65004e'
  const query: PAPacket = setClientName(0, 'custom-name')
  t.is(query.write().toString('hex'), COMMAND_RESULT)
})

// Replies
test(`getSinks() reply`, t => {
  const buffer: Buffer = Buffer.from('00000416ffffffff0000000000000000000000004c000000024c000000034c0000000174616c73615f6f75747075742e64656661756c74007462636d3238333520414c5341006103020000ac446d0201024c0000001376020001000000010000304c0000000174616c73615f6f75747075742e64656661756c742e6d6f6e69746f7200550000000000000000746d6f64756c652d616c73612d73696e6b2e63004c000000a65074616c73612e7265736f6c7574696f6e5f62697473004c000000037800000003313600746465766963652e617069004c000000057800000005616c736100746465766963652e636c617373004c000000067800000006736f756e640074616c73612e636c617373004c00000008780000000867656e657269630074616c73612e737562636c617373004c0000000c780000000c67656e657269632d6d69780074616c73612e6e616d65004c0000000d780000000d62636d3238333520414c53410074616c73612e6964004c0000000d780000000d62636d3238333520414c53410074616c73612e737562646576696365004c000000027800000002300074616c73612e7375626465766963655f6e616d65004c0000000d780000000d7375626465766963652023300074616c73612e646576696365004c000000027800000002300074616c73612e63617264004c000000027800000002300074616c73612e636172645f6e616d65004c0000000d780000000d62636d3238333520414c53410074616c73612e6c6f6e675f636172645f6e616d65004c0000000d780000000d62636d3238333520414c53410074616c73612e6472697665725f6e616d65004c0000000c780000000c736e645f62636d3238333500746465766963652e6275735f70617468004c0000002c780000002c2f646576696365732f706c6174666f726d2f736f632f736f633a617564696f2f736f756e642f6361726430007473797366732e70617468004c0000002c780000002c2f646576696365732f706c6174666f726d2f736f632f736f633a617564696f2f736f756e642f636172643000746465766963652e737472696e67004c00000008780000000864656661756c7400746465766963652e627566666572696e672e6275666665725f73697a65004c00000007780000000731333130373200746465766963652e627566666572696e672e667261676d656e745f73697a65004c00000007780000000731333130373200746465766963652e6163636573735f6d6f6465004c0000000b780000000b6d6d61702b74696d657200746465766963652e6465736372697074696f6e004c0000000d780000000d62636d3238333520414c534100746465766963652e69636f6e5f6e616d65004c0000000b780000000b617564696f2d63617264004e55000000000000000056000100004c000000024c000100014cffffffff4c000000004e4201664201504e','hex')
  const reply: PAPacket = new PAPacket(buffer)
  t.pass()
})